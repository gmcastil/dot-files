#!/bin/bash

#
# Create a prompt with the following characteristics
#
#   username@hostname [hist_no] {timestamp} [?] (versioning) /absolute/path/to/pwd
#   $
#
# TODO:
#   Add colorization of the last return value
# TODO:
#   This needs to be made Zsh compatible to handle being run on Mac OS or something
#   of that nature.  Might need to do something like have .bash_prompt or .zsh_prompt.
# TODO:
#   Add colorization of the timestamp, username, hostname, history number
# TODO:
#   Signify if there are cached sudo credentials
# TODO:
#   Add version control and branch names 

function prompt_command () {

  # Save last return value since following commands will trample it
  local last_retval=$?

  # Username and hostname
  local user_host="\u@\h"
  local fmt_user_host=${user_host}

  # Command history string
  local hist="\!"
  local fmt_hist=[${hist}]

  # Timestamp string
  local timestamp="\D{%Y-%m-%d %H:%M:%S}"
  local fmt_timestamp="{${timestamp}}"

  # Return value string
  local fmt_last_retval=[${last_retval}]

  # Version control string
  local fmt_vcs=

  # PWD string - this may only be valid on bash or zsh
  local unsym_pwd
  unsym_pwd=$(builtin pwd -P)
  local fmt_pwd=${unsym_pwd}

  # Composite PS1 expression to use
  PS1="${fmt_user_host} ${fmt_hist} ${fmt_timestamp} ${fmt_last_retval} ${fmt_vcs} ${fmt_pwd}\r\n\$ "

}

export PROMPT_COMMAND=prompt_command
